

# ğŸ“¦ Fiber

Fiber è¡¨ç¤ºå¼€å§‹åˆ›å»ºå®ä¾‹çš„ fiber åŒ…

## New

æ­¤æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ **App** å‘½åå®ä¾‹ã€‚æ‚¨å¯ä»¥åœ¨åˆ›å»ºæ–°å®ä¾‹æ—¶ä¼ é€’å¯é€‰çš„[è®¾ç½®](https://github.com/gofiber/docs/blob/master/api/app.md#settings)

**ç­¾åï¼š**

```go
func New(config ...Config) *App
```

**ç¤ºä¾‹ï¼š**

```go
// é»˜è®¤é…ç½®
app := fiber.New()

// ...
```

## Config

åœ¨åˆ›å»ºæ–° Fiber å®ä¾‹æ—¶ï¼Œå¯ä»¥ä¼ é€’å¯é€‰é…ç½®

**ç¤ºä¾‹ï¼š**

```go
//è‡ªå®šä¹‰é…ç½®
app := fiber.New(fiber.Config{
    Prefork:       true,
    CaseSensitive: true,
    StrictRouting: true,
    ServerHeader:  "Fiber",
    AppName: "Test App v1.0.1"
})

// ...
```

**é…ç½®å­—æ®µ**

| å±æ€§                                              | ç±»å‹            | æè¿°                                                         | é»˜è®¤å€¼                |
| :------------------------------------------------ | :-------------- | :----------------------------------------------------------- | :-------------------- |
| Prefork (é¢„å¤„ç†)                                  | `bool`          | å…è®¸ä½¿ç”¨ [`SO_REUSEPORT`](https://lwn.net/Articles/542629/)å¥—æ¥å­—é€‰é¡¹ã€‚è¿™å°†äº§ç”Ÿå¤šä¸ª Go è¿›ç¨‹ï¼Œç›‘å¬åŒä¸€ç«¯å£ã€‚äº†è§£æœ‰å…³[å¥—æ¥å­—åˆ‡åˆ†](https://www.nginx.com/blog/socket-sharding-nginx-release-1-9-1/)çš„è¯¦ç»†ä¿¡æ¯**æ³¨æ„ï¼šå¦‚æœå¯ç”¨ï¼Œåº”ç”¨ç¨‹åºå°†éœ€è¦é€šè¿‡ shell è¿è¡Œï¼Œå› ä¸ºé¢„å·¥ä½œæ¨¡å¼è®¾ç½®ç¯å¢ƒå˜é‡ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Dockerï¼Œè¯·ç¡®ä¿åº”ç”¨ç¨‹åºä½¿ç”¨ `CMD ./app` æˆ– `CMD ["sh", "-c", "/app"]`ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§**[**æ­¤**](https://github.com/gofiber/fiber/issues/1021#issuecomment-730537971)**å‘è¡¨æ„è§ã€‚** | `false`               |
| ServerHeader (æœåŠ¡å™¨å¤´)                           | `string`        | ä½¿ç”¨ç»™å®šå€¼å¯ç”¨`æœåŠ¡å™¨` HTTP å¤´ã€‚                             | `""`                  |
| StrictRouting (ä¸¥æ ¼è·¯ç”±)                          | `bool`          | å¯ç”¨æ—¶ï¼Œè·¯ç”±å™¨å°† `/foo` å’Œ `/foo/` è§†ä¸ºä¸åŒã€‚å¦åˆ™ï¼Œè·¯ç”±å™¨å°† `/Foo` å’Œ `/foo/` è§†ä¸ºç›¸åŒ | `false`               |
| CaseSensitive (åŒºåˆ†å¤§å°å†™)                        | `bool`          | å¯ç”¨æ—¶ï¼Œ`/Foo` å’Œ `/Foo` æ˜¯ä¸åŒçš„è·¯ç”±ã€‚ç¦ç”¨æ—¶ï¼Œ`/Foo` å’Œ `/foo` è§†ä¸ºç›¸åŒ | `false`               |
| Immutable (ä¸å¯å˜)                                | `bool`          | å¯ç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡æ–¹æ³•è¿”å›çš„æ‰€æœ‰å€¼éƒ½æ˜¯ä¸å¯å˜çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬åœ¨æ‚¨ä»å¤„ç†ç¨‹åºè¿”å›ä¹‹å‰æ˜¯æœ‰æ•ˆçš„ï¼›è§ç¬¬[#185](https://github.com/gofiber/fiber/issues/185) æœŸ. | `false`               |
| UnescapePath (æœªè§£é™¤è·¯å¾„)                         | `bool`          | åœ¨è®¾ç½®ä¸Šä¸‹æ–‡è·¯å¾„ä¹‹å‰å°†è·¯ç”±ä¸­çš„æ‰€æœ‰ç¼–ç å­—ç¬¦è½¬æ¢å›ï¼Œä»¥ä¾¿è·¯ç”±ä¹Ÿå¯ä»¥ä½¿ç”¨ URL ç¼–ç çš„ç‰¹æ®Šå­—ç¬¦ | `false`               |
| ETagï¼ˆE æ ‡ç­¾ï¼‰                                    | `bool`          | å¯ç”¨æˆ–ç¦ç”¨ ETag å¤´ç”Ÿæˆï¼Œå› ä¸ºå¼± ETag å’Œå¼º ETag éƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„å“ˆå¸Œæ–¹æ³• (CRC-32) ç”Ÿæˆçš„ã€‚å¼± ETag æ˜¯å¯ç”¨æ—¶çš„é»˜è®¤å€¼ | `false`               |
| BodyLimitï¼ˆBody é™åˆ¶ï¼‰                            | `int`           | è®¾ç½®è¯·æ±‚æ­£æ–‡å…è®¸çš„æœ€å¤§å¤§å°ï¼Œå¦‚æœå¤§å°è¶…è¿‡é…ç½®çš„é™åˆ¶ï¼Œåˆ™å‘é€ `413 - Request Entity Too Large` å“åº” | `4*1024*1024`         |
| Concurrencyï¼ˆå¹¶å‘ï¼‰                               | `int`           | æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚                                             | `256*1024`            |
| Viewsï¼ˆè§†å›¾ï¼‰                                     | `Views`         | è§†å›¾æ˜¯åŒ…è£…æ¸²æŸ“åŠŸèƒ½çš„ç•Œé¢ã€‚æœ‰å…³æ”¯æŒçš„å¼•æ“ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„**æ¨¡æ¿ä¸­é—´ä»¶** | `nil`                 |
| ReadTimeoutï¼ˆè¯»å–æ—¶é—´ï¼‰                           | `time.Duration` | å…è®¸è¯»å–å®Œæ•´è¯·æ±‚ (åŒ…æ‹¬æ­£æ–‡) çš„æ—¶é—´é‡ã€‚é»˜è®¤è¶…æ—¶æ˜¯æ— é™åˆ¶çš„     | `nil`                 |
| WriteTimeoutï¼ˆå†™å…¥æ—¶é—´ï¼‰                          | `time.Duration` | å“åº”è¶…æ—¶å†™å…¥ä¹‹å‰çš„æœ€å¤§æŒç»­æ—¶é—´ã€‚é»˜è®¤è¶…æ—¶æ˜¯æ— é™åˆ¶çš„           | `nil`                 |
| IdleTimeoutï¼ˆé—²ç½®æ—¶é—´ï¼‰                           | `time.Duration` | å¯ç”¨ä¿æŒæ´»åŠ¨çŠ¶æ€æ—¶ç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœ IdleTimeout ä¸ºé›¶ï¼Œåˆ™ä½¿ç”¨ ReadTimeout çš„å€¼ | `nil`                 |
| ReadBufferSizeï¼ˆè¯»å–ç¼“å†²å¤§å°ï¼‰                    | `int`           | æ¯ä¸ªè¯·æ±‚è¯»å–çš„è¿æ¥ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¹Ÿé™åˆ¶äº†æœ€å¤§æ ‡é¢˜å¤§å°ã€‚å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯å‘é€å¤š KB è¯·æ±‚ URI å’Œ / æˆ–å¤š KB æ ‡å¤´ (ä¾‹å¦‚ï¼Œå¤§ cookie)ï¼Œè¯·å¢åŠ æ­¤ç¼“å†²åŒº | `4096`                |
| WriteBufferSize ï¼ˆå†™å…¥ç¼“å†²å¤§å°ï¼‰                  | `int`           | å“åº”å†™å…¥çš„æ¯ä¸ªè¿æ¥ç¼“å†²åŒºå¤§å°ã€‚                               | `4096`                |
| CompressedFileSuffix ï¼ˆå‹ç¼©æ–‡ä»¶åç¼€ï¼‰             | `string`        | ä¸ºåŸå§‹æ–‡ä»¶åæ·»åŠ åç¼€ï¼Œå¹¶å°è¯•ä»¥æ–°æ–‡ä»¶åä¿å­˜ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶ã€‚   | `".fiber.gz"`         |
| ProxyHeaderï¼ˆä»£ç†å¤´ï¼‰                             | `string`        | è¿™å°†ä½¿ `c.IP()` èƒ½å¤Ÿè¿”å›ç»™å®šæ ‡å¤´é”®çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`c.IP()` å°†ä» TCP è¿æ¥è¿”å›è¿œç¨‹ IPï¼Œå¦‚æœæ‚¨åœ¨è´Ÿè½½å¹³è¡¡å™¨åé¢ï¼Œä¾‹å¦‚ **X-Forwarded-**ï¼Œåˆ™æ­¤å±æ€§å¯èƒ½å¾ˆæœ‰ç”¨ | `""`                  |
| GETOnly ï¼ˆä»…é™ GETï¼‰                              | `bool`          | å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™æ‹’ç»æ‰€æœ‰é GET è¯·æ±‚ã€‚å¯¹äºä»…æ¥å— GET è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œæ­¤é€‰é¡¹ä½œä¸ºé˜² DoS ä¿æŠ¤éå¸¸æœ‰ç”¨ã€‚å¦‚æœè®¾ç½®äº† GETOnlyï¼Œåˆ™è¯·æ±‚å¤§å°å— ReadBufferSize é™åˆ¶ | `false`               |
| ErrorHandlerï¼ˆé”™è¯¯è¯·æ±‚å¤´ï¼‰                        | `ErrorHandler`  | å½“ fiber è¿”å›é”™è¯¯æ—¶ï¼Œæ‰§è¡Œ ErrorHandlerã€‚å¤„ç†ç¨‹åºã€‚å®‰è£…çš„ fiber é”™è¯¯å¤„ç†ç¨‹åºç”±é¡¶çº§åº”ç”¨ç¨‹åºä¿ç•™ï¼Œå¹¶åº”ç”¨äºå‰ç¼€ç›¸å…³è¯·æ±‚ | `DefaultErrorHandler` |
| DisableKeepaliveï¼ˆå…³é—­è¿æ¥ï¼‰                      | `bool`          | ç¦ç”¨ä¿æŒæ´»åŠ¨è¿æ¥ï¼ŒæœåŠ¡å™¨å°†åœ¨å‘å®¢æˆ·ç«¯å‘é€ç¬¬ä¸€ä¸ªå“åº”åå…³é—­ä¼ å…¥è¿æ¥ | `false`               |
| DisableDefaultDate ï¼ˆå…³é—­é»˜è®¤æ—¶é—´ï¼‰               | `bool`          | å½“è®¾ç½®ä¸º true æ—¶ï¼Œå°†å¯¼è‡´ä»å“åº”ä¸­æ’é™¤é»˜è®¤æ—¥æœŸå¤´ã€‚             | `false`               |
| DisableDefaultContentTypeï¼ˆå…³é—­é»˜è®¤å†…å®¹ç±»å‹ï¼‰     | `bool`          | è®¾ç½®ä¸º true æ—¶ï¼Œå°†å¯¼è‡´ä»å“åº”ä¸­æ’é™¤é»˜è®¤å†…å®¹ç±»å‹æ ‡é¢˜ã€‚         | `false`               |
| DisableHeaderNormalizingï¼ˆå…³é—­å¤´æ­£å¸¸åŒ–ï¼‰          | `bool`          | é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ ‡é¢˜åç§°éƒ½æ˜¯æ ‡å‡†åŒ–çš„ï¼šå†…å®¹ç±»å‹ -> å†…å®¹ç±»å‹   | `false`               |
| DisableStartupMessageï¼ˆå…³é—­å¯åŠ¨ä¿¡æ¯)              | `bool`          | è®¾ç½®ä¸º true æ—¶ï¼Œå®ƒä¸ä¼šæ‰“å°è°ƒè¯•ä¿¡æ¯                           | `false`               |
| AppName (åº”ç”¨å)                                  | `string`        | è¿™å…è®¸ä¸ºåº”ç”¨è®¾ç½®åº”ç”¨åç§°                                     | `""`                  |
| EnableTrustedProxyCheckï¼ˆå¯ç”¨å¯ä¿¡ä»»ä»£ç†æ£€æŸ¥ï¼‰     | `bool`          | è®¾ç½®ä¸º true æ—¶ï¼Œfiber å°†ä½¿ç”¨ TrustedProxy åˆ—è¡¨æ£€æŸ¥ä»£ç†æ˜¯å¦å—ä¿¡ä»»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`c.Protocol()` å°†ä» X-Forwarded-Protoã€X-Forwarded-Protocolã€X-Forwarded-Ssl æˆ– X-Url-Scheme å¤´è·å–å€¼ï¼Œ`c.IP()` å°†ä»ä»£ç†å¤´è·å–å€¼ï¼Œ`c.Hostname()` å°†ä» X-Forwarded-Host å¤´è·å–å€¼ã€‚å¦‚æœ `EnableTrustedProxyCheck` ä¸º trueï¼Œå¹¶ä¸” `RemoteIP` åœ¨å—ä¿¡ä»»ä»£ç†çš„åˆ—è¡¨ä¸­ `c.Protocol()`ï¼Œ`c.IP()` å’Œ `c.Hostname()` å°†åœ¨ç¦ç”¨å—ä¿¡ä»»ä»£ç†æ—¶å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œå¦‚æœ `RemoteIP` ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œ`c.Protocol()` å°†åœ¨åº”ç”¨ç¨‹åºå¤„ç† tls è¿æ¥æ—¶è¿”å› httpsï¼Œå¦åˆ™ï¼Œ`c.IP()` å°†ä» fasthttp ä¸Šä¸‹æ–‡è¿”å› RemoteIP () ï¼Œ`c.Hostname()` å°†è¿”å› `fasthttp.Request.URI().Host()` | `false`               |
| TrustedProxiesï¼ˆå¯ä¿¡ä»»ä»£ç†ï¼‰                      | `[]string`      | åŒ…å«å—ä¿¡ä»»ä»£ç† IP çš„åˆ—è¡¨ã€‚è¯·æŸ¥çœ‹`å¯ç”¨å—ä¿¡ä»»ä»£ç†æ£€æŸ¥`æ–‡æ¡£ã€‚å®ƒå¯ä»¥é‡‡ç”¨ IP æˆ– IP èŒƒå›´åœ°å€ã€‚å¦‚æœå®ƒå¾—åˆ° IP èŒƒå›´ï¼Œå®ƒå°†è¿­ä»£æ‰€æœ‰å¯èƒ½çš„åœ°å€ | `[]string*__*`        |
| DisablePrepareSMultipartForm ï¼ˆå…³é—­å¤åˆæ–‡ä»¶è¡¨å•ï¼‰ | `bool`          | å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™ä¸ä¼šé¢„è§£æå¤šéƒ¨åˆ†è¡¨å•æ•°æ®ã€‚æ­¤é€‰é¡¹å¯¹äºå¸Œæœ›å°†å¤šéƒ¨åˆ†è¡¨å•æ•°æ®è§†ä¸ºäºŒè¿›åˆ¶ blob æˆ–é€‰æ‹©ä½•æ—¶è§£ææ•°æ®çš„æœåŠ¡å™¨éå¸¸æœ‰ç”¨ | `false`               |
| StreamRequestBodyï¼ˆæµåª’ä½“è¯·æ±‚å†…å®¹ï¼‰               | `bool`          | StreamRequestBody å¯ç”¨è¯·æ±‚æ­£æ–‡æµï¼Œå¹¶åœ¨ç»™å®šæ­£æ–‡å¤§äºå½“å‰é™åˆ¶æ—¶æ›´å¿«è°ƒç”¨å¤„ç†ç¨‹åºã€‚ | `false`               |

## NewError

NewError ä½¿ç”¨å¯é€‰æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„ httperror å®ä¾‹ã€‚

**ç­¾åï¼š**

```go
func NewError(code int, message ...string) *Error
```

**ç¤ºä¾‹ï¼š**

```go
app.Get("/", func(c *fiber.Ctx) error {
    return fiber.NewError(782, "Custom error message")
})
```

## IsChild

Ischild ç¡®å®šå½“å‰è¿›ç¨‹æ˜¯å¦æ˜¯é¢„å¤„ç†çš„ç»“æœã€‚

**ç­¾åï¼š**

```go
func IsChild() bool
```

**ç¤ºä¾‹ï¼š**

```go
//é¢„å¤„ç†å°†äº§ç”Ÿå­è¿›ç¨‹
app := fiber.New(fiber.Config{
    Prefork: true,
})

if !fiber.IsChild() {
    fmt.Println("I'm the parent process")
} else {
    fmt.Println("I'm a child process")
}

// ...
```